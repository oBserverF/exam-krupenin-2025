{% extends 'base.html' %}
{% block title %}–ì–ª–∞–≤–Ω–∞—è{% endblock %}
{% block content %}
<h2>–ü–æ—Å–ª–µ–¥–Ω–∏–µ —Ä–µ—Ü–µ–ø—Ç—ã</h2>

{% if current_user.is_authenticated %}
  <div class="mb-3">
    <a href="{{ url_for('recipe.create') }}" class="btn btn-success">–î–æ–±–∞–≤–∏—Ç—å —Ä–µ—Ü–µ–ø—Ç</a>
  </div>
{% endif %}

{% for recipe in recipes.items %}
  <div class="card mb-3">
    <div class="card-body">
      <h4 class="card-title">{{ recipe.title }}</h4>
      <p class="card-text">
        ‚è± {{ recipe.cook_time }} –º–∏–Ω | üçΩ {{ recipe.portions }} –ø–æ—Ä—Ü–∏–π<br>
        ‚≠ê –°—Ä–µ–¥–Ω—è—è –æ—Ü–µ–Ω–∫–∞: {{ recipe.average_rating() or '–ù–µ—Ç' }} ({{ recipe.reviews | length }} –æ—Ç–∑—ã–≤–æ–≤)
      </p>
      <a href="{{ url_for('recipe.view', recipe_id=recipe.id) }}" class="btn btn-primary btn-sm">–ü—Ä–æ—Å–º–æ—Ç—Ä</a>

      {% if current_user.is_authenticated and (recipe.author_id == current_user.id or current_user.role.name == '–∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä') %}
        <a href="{{ url_for('recipe.edit', recipe_id=recipe.id) }}" class="btn btn-warning btn-sm">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</a>
        <a href="{{ url_for('recipe.delete', recipe_id=recipe.id) }}" class="btn btn-danger btn-sm"
           onclick="return confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —Ä–µ—Ü–µ–ø—Ç {{ recipe.title }}?')">–£–¥–∞–ª–∏—Ç—å</a>
      {% endif %}
    </div>
  </div>
{% else %}
  <p>–ü–æ–∫–∞ —Ä–µ—Ü–µ–ø—Ç–æ–≤ –Ω–µ—Ç.</p>
{% endfor %}

<!-- –ü–∞–≥–∏–Ω–∞—Ü–∏—è -->
<nav>
  <ul class="pagination">
    {% if recipes.has_prev %}
      <li class="page-item">
        <a class="page-link" href="{{ url_for('recipe.index', page=recipes.prev_num) }}">–ù–∞–∑–∞–¥</a>
      </li>
    {% endif %}
    {% for p in recipes.iter_pages() %}
      {% if p %}
        <li class="page-item {% if p == recipes.page %}active{% endif %}">
          <a class="page-link" href="{{ url_for('recipe.index', page=p) }}">{{ p }}</a>
        </li>
      {% else %}
        <li class="page-item disabled"><span class="page-link">‚Ä¶</span></li>
      {% endif %}
    {% endfor %}
    {% if recipes.has_next %}
      <li class="page-item">
        <a class="page-link" href="{{ url_for('recipe.index', page=recipes.next_num) }}">–í–ø–µ—Ä—ë–¥</a>
      </li>
    {% endif %}
  </ul>
</nav>
{% endblock %}
